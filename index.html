<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Graviti Pharmaceuticals – Manufacturing Planner</title>
    <!-- Tailwind & other CDNs -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chrono-node/1.3.11/chrono.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <style>
        /* custom styles for sticky column */
        .sticky-col { position: sticky; left: 0; z-index: 10; }
        @media print {
            .no-print { display: none; }
            table { font-size: 10px; }
            th, td { padding: 4px; }
        }
    </style>
</head>
<body class="bg-gray-100">
<div id="root"></div>

<script type="text/babel">
    /* ========== default seed data ========== */
    const defaultUsers = [
        { username: "superadmin", password: "admin123", role: "Super Admin", mustChangePassword: true },
        { username: "admin",      password: "admin123", role: "Admin",       mustChangePassword: true },
        { username: "user",       password: "user123",  role: "User",        mustChangePassword: true }
    ];

    const initialData = [
        { process: "Granulation 150 L", total: 12 },
        { process: "Granulation 700 L", total: 82.65 }
    ].map(row => {
        const obj = { process: row.process, total: row.total };
        const serial = Math.floor((new Date(2025, 6, 1) - new Date(1970, 0, 1)) / (1000 * 60 * 60 * 24)) + 25569;
        for (let i = 0; i < 30; i++) {
            obj[(serial + i).toString()] = i === 5 && row.process === "Granulation 150 L" ? 12 :
                                           row.process === "Granulation 700 L" ? [2, 6.1, 0, 6.1, 6.1, 4.1, 6.1, 4.15, 2.05, 0, 2.55, 20.7, 16.4, 6.4][i] || 0 : 0;
        }
        return obj;
    });

    /* ========== React App ========== */
    const App = () => {
        /* ---------- state ---------- */
        const [user, setUser]               = React.useState(JSON.parse(localStorage.getItem('currentUser')) || null);
        const [users, setUsers]             = React.useState(JSON.parse(localStorage.getItem('users')) || defaultUsers);
        const [data, setData]               = React.useState(JSON.parse(localStorage.getItem('manufacturingData_2025_7')) || initialData);
        const [showSignup, setShowSignup]   = React.useState(false);
        const [showUserMgmt, setShowUserMgmt] = React.useState(false);
        const [showChangePwd, setShowChangePwd] = React.useState(false);
        const [logo, setLogo]               = React.useState(localStorage.getItem('logo') || "https://via.placeholder.com/170x66");
        const [currentMonth, setCurrentMonth] = React.useState(7);
        const [currentYear, setCurrentYear]   = React.useState(2025);
        const [currentTime, setCurrentTime]   = React.useState(new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' }));
        const [editingProcess, setEditingProcess] = React.useState(null);
        const [editProcessValue, setEditProcessValue] = React.useState('');
        const [mustChangePwd, setMustChangePwd] = React.useState(false);
        const [showAddUser, setShowAddUser] = React.useState(false);
        const [showDelWarn, setShowDelWarn] = React.useState(null);

        /* ---------- side effects ---------- */
        React.useEffect(() => {
            const t = setInterval(() => setCurrentTime(new Date().toLocaleString('en-IN', {timeZone:'Asia/Kolkata'})), 1000);
            return () => clearInterval(t);
        }, []);

        React.useEffect(() => {
            if (user?.mustChangePassword) setMustChangePwd(true);
        }, [user]);

        /* ---------- persistence helpers ---------- */
        const saveUsers = (arr) => { setUsers(arr); localStorage.setItem('users', JSON.stringify(arr)); };
        const saveData  = (d)   => { setData(d);   localStorage.setItem(`manufacturingData_${currentYear}_${currentMonth}`, JSON.stringify(d)); };

        /* ---------- auth ---------- */
        const handleLogin = (un, pw) => {
            const found = users.find(u => u.username === un && u.password === pw);
            if (!found) return alert('Invalid credentials.');
            setUser(found);
            localStorage.setItem('currentUser', JSON.stringify(found));
            if (found.mustChangePassword) setMustChangePwd(true);
        };

        const handleSignup = (un, pw, cpw) => {
            if (pw.length < 8) return alert('≥8 chars');
            if (pw !== cpw) return alert('Passwords mismatch');
            if (users.find(u => u.username === un)) return alert('User exists');
            const nu = {username: un, password: pw, role: 'User', mustChangePassword: false};
            saveUsers([...users, nu]);
            alert('Account created!');
            setShowSignup(false);
        };

        const handleLogout = () => { setUser(null); localStorage.removeItem('currentUser'); };

        /* ---------- user management ---------- */
        const handleRoleChange = (un, newRole) => {
            const updated = users.map(u => u.username===un ? {...u, role:newRole} : u);
            saveUsers(updated);
            if (user.username === un) {
                const nu = {...user, role:newRole};
                setUser(nu);
                localStorage.setItem('currentUser', JSON.stringify(nu));
            }
            alert('Role updated');
        };

        const handleAddUser = (un, role) => {
            if (!un.trim()) return alert('Empty username');
            if (users.find(u => u.username === un)) return alert('User exists');
            const nu = {username: un, password: 'password123', role, mustChangePassword: true};
            saveUsers([...users, nu]);
            alert('User added. Default password: password123');
            setShowAddUser(false);
        };

        const handleDeleteUser = (un) => {
            if (un === 'superadmin') return alert('Cannot delete superadmin');
            const updated = users.filter(u => u.username !== un);
            saveUsers(updated);
            if (user.username === un) handleLogout();
        };

        const handleChangePassword = (oldPw, newPw, confirmPw) => {
            if (oldPw !== user.password) return alert('Wrong old password');
            if (newPw.length < 8) return alert('≥8 chars');
            if (newPw !== confirmPw) return alert('Mismatch');
            const updated = users.map(u => u.username === user.username ? {...u, password:newPw, mustChangePassword:false} : u);
            saveUsers(updated);
            const nu = {...user, password:newPw, mustChangePassword:false};
            setUser(nu);
            localStorage.setItem('currentUser', JSON.stringify(nu));
            alert('Password changed');
            setShowChangePwd(false);
            setMustChangePwd(false);
        };

        /* ---------- data editing ---------- */
        const handleDataEdit = (rowIndex, col, val) => {
            const newData = [...data];
            newData[rowIndex][col] = val;
            if (col !== 'process' && col !== 'total') {
                newData[rowIndex].total = Object.keys(newData[rowIndex])
                    .filter(k => !isNaN(k) && k!=='total')
                    .reduce((s,k)=>(s+(parseFloat(newData[rowIndex][k])||0)),0);
            }
            saveData(newData);
        };

        /* ---------- process name editing ---------- */
        const handleProcessDblClick = (rowIndex) => {
            setEditingProcess(rowIndex);
            setEditProcessValue(data[rowIndex].process);
        };

        const handleSaveProcess = (rowIndex) => {
            const val = editProcessValue.trim();
            if (!val) return alert('Empty name');
            if (data.some((r,i)=>i!==rowIndex && r.process === val)) return alert('Duplicate name');
            const newData = [...data];
            newData[rowIndex].process = val;
            saveData(newData);
            setEditingProcess(null);
            setEditProcessValue('');
        };

        const handleDeleteEquipment = (rowIndex) => {
            const newData = data.filter((_,i)=>i!==rowIndex);
            saveData(newData);
            setShowDelWarn(null);
        };

        const handleAddEquipment = (name) => {
            const val = name.trim();
            if (!val) return alert('Empty name');
            if (data.some(r=>r.process===val)) return alert('Duplicate name');
            const days = 30; // Fixed to 30 days
            const serial = Math.floor((new Date(currentYear, currentMonth-1, 1) - new Date(1970,0,1))/(1000*60*60*24)) + 25569;
            const obj = {process: val, total:0};
            for (let i=0; i<days; i++) obj[(serial+i).toString()] = 0;
            const newData = [...data, obj];
            saveData(newData);
            document.getElementById('new-equipment').value='';
        };

        const handleMoveUp   = (i) => { if (i===0) return; const d=[...data]; [d[i-1],d[i]]=[d[i],d[i-1]]; saveData(d); };
        const handleMoveDown = (i) => { if (i===data.length-1) return; const d=[...data]; [d[i],d[i+1]]=[d[i+1],d[i]]; saveData(d); };

        /* ---------- logo upload ---------- */
        const handleLogoUpload = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = ev => { setLogo(ev.target.result); localStorage.setItem('logo', ev.target.result); };
            reader.readAsDataURL(file);
        };

        /* ---------- export functionalities ---------- */
        const handleExportCSV = () => {
            const headers = ['Process / Equipment', ...Object.keys(data[0] || {})
                .filter(k => k !== 'process' && k !== 'total')
                .map(date => formatDate(parseInt(date))), 'Total'];
            const csvData = [
                headers,
                ...data.map(row => [
                    row.process,
                    ...Object.keys(row).filter(k => k !== 'process' && k !== 'total').map(col => row[col]),
                    row.total
                ])
            ];
            const csv = Papa.unparse(csvData);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Manufacturing_Plan_${currentYear}_${currentMonth}.csv`;
            link.click();
        };

        const handleExportPDF = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape' });
            doc.setFontSize(16);
            doc.text('Graviti Pharmaceuticals - Manufacturing Plan', 14, 20);
            doc.setFontSize(12);
            doc.text(`${new Date(currentYear, currentMonth-1).toLocaleString('en-US', { month: 'long', year: 'numeric' })}`, 14, 30);
            const headers = ['Process / Equipment', ...Object.keys(data[0] || {})
                .filter(k => k !== 'process' && k !== 'total')
                .map(date => formatDate(parseInt(date))), 'Total'];
            const tableData = data.map(row => [
                row.process,
                ...Object.keys(row).filter(k => k !== 'process' && k !== 'total').map(col => row[col].toString()),
                row.total.toString()
            ]);
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 40,
                styles: { fontSize: 8, cellPadding: 2 },
                columnStyles: { 0: { cellWidth: 30 } },
                theme: 'grid'
            });
            doc.save(`Manufacturing_Plan_${currentYear}_${currentMonth}.pdf`);
        };

        const handlePrint = () => {
            window.print();
        };

        /* ---------- calendar helpers ---------- */
        const formatDate = serial => new Date((serial-25569)*86400*1000).toLocaleDateString('en-US', {month:'short', day:'numeric'});
        const monthOptions = Array.from({length:12}, (_, i) => ({value: i+1, label: new Date(2025, i, 1).toLocaleString('en-US', {month: 'long'})}));
        const yearOptions = Array.from({length:11}, (_, i) => 2020+i);

        const handleMonthChange = (m, y) => {
            setCurrentMonth(m);
            setCurrentYear(y);
            const days = 30; // Fixed to 30 days
            const serial = Math.floor((new Date(y, m-1, 1) - new Date(1970, 0, 1)) / (1000 * 60 * 60 * 24)) + 25569;
            const stored = JSON.parse(localStorage.getItem(`manufacturingData_${y}_${m}`));
            const fallback = initialData.map(r => {
                const row = { process: r.process, total: 0 };
                for (let i = 0; i < days; i++) row[(serial+i).toString()] = 0;
                return row;
            });
            setData(stored || fallback);
        };

        /* ---------- render ---------- */
        if (!user) {
            return (
                <div className="flex items-center justify-center min-h-screen">
                    <div className="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
                        <div className="flex flex-col items-center mb-6">
                            <label htmlFor="logo-upload" className="cursor-pointer mb-2">
                                <input type="file" id="logo-upload" accept="image/*" className="hidden" onChange={handleLogoUpload}/>
                                <img src={logo} alt="Logo" className="w-[170px] h-[66px] object-contain"/>
                                <p className="text-xs text-gray-500 text-center">Click to upload (170×66)</p>
                            </label>
                            <h1 className="text-2xl font-bold text-gray-800">Graviti Pharmaceuticals</h1>
                            <p className="text-gray-600">Manufacturing Planner</p>
                        </div>
                        {!showSignup ? (
                            <div className="space-y-4">
                                <input id="login-username" placeholder="Username" className="w-full p-2 border rounded-md"/>
                                <input id="login-password" type="password" placeholder="Password" className="w-full p-2 border rounded-md"/>
                                <button className="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700"
                                        onClick={() => handleLogin(document.getElementById('login-username').value, document.getElementById('login-password').value)}>Login</button>
                                <p className="text-sm text-center">No account? <a href="#" onClick={() => setShowSignup(true)} className="text-blue-600 hover:underline">Sign up</a></p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <input id="signup-username" placeholder="Username" className="w-full p-2 border rounded-md"/>
                                <input id="signup-password" type="password" placeholder="Password" className="w-full p-2 border rounded-md"/>
                                <input id="confirm-password" type="password" placeholder="Confirm" className="w-full p-2 border rounded-md"/>
                                <p className="text-xs text-gray-500">≥8 characters</p>
                                <div className="flex justify-end space-x-2">
                                    <button className="px-4 py-2 bg-gray-300 rounded-md" onClick={() => setShowSignup(false)}>Cancel</button>
                                    <button className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                                            onClick={() => handleSignup(document.getElementById('signup-username').value, document.getElementById('signup-password').value, document.getElementById('confirm-password').value)}>Create</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        if (mustChangePwd) {
            return (
                <div className="flex items-center justify-center min-h-screen">
                    <div className="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
                        <h2 className="text-xl font-bold mb-4">Change Password (First Login)</h2>
                        <div className="space-y-4">
                            <input id="old-pwd" type="password" placeholder="Old password" className="w-full p-2 border rounded-md"/>
                            <input id="new-pwd" type="password" placeholder="New password" className="w-full p-2 border rounded-md"/>
                            <input id="confirm-new-pwd" type="password" placeholder="Confirm new" className="w-full p-2 border rounded-md"/>
                            <p className="text-xs text-gray-500">≥8 characters</p>
                            <button className="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700"
                                    onClick={() => handleChangePassword(document.getElementById('old-pwd').value, document.getElementById('new-pwd').value, document.getElementById('confirm-new-pwd').value)}>Save</button>
                        </div>
                    </div>
                </div>
            );
        }

        return (
            <div className="min-h-screen">
                {/* header */}
                <nav className="bg-blue-600 text-white p-4 flex justify-between items-center">
                    <div className="flex items-center space-x-3">
                        <img src={logo} alt="Logo" className="h-12 w-auto object-contain"/>
                        <h1 className="text-xl font-bold">Graviti Pharmaceuticals</h1>
                        <p className="text-sm">Manufacturing Planner</p>
                    </div>
                    <div className="flex items-center space-x-4">
                        <span>{currentTime}</span>
                        <span>Welcome, {user.username} ({user.role})</span>
                        {user.role === 'Super Admin' && <button className="bg-white text-blue-600 px-3 py-1 rounded-md" onClick={() => setShowUserMgmt(true)}>Manage Users</button>}
                        {(user.role === 'Super Admin' || user.role === 'Admin') && <button className="bg-white text-blue-600 px-3 py-1 rounded-md" onClick={() => setShowChangePwd(true)}>Change Password</button>}
                        <button className="bg-white text-blue-600 px-3 py-1 rounded-md" onClick={handleLogout}>Logout</button>
                    </div>
                </nav>

                {/* user management modal */}
                {showUserMgmt && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40">
                        <div className="bg-white p-6 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-y-auto">
                            <h2 className="text-xl font-bold mb-4">User Management</h2>
                            <table className="w-full mb-4">
                                <thead><tr className="bg-gray-200"><th className="p-2">Username</th><th className="p-2">Role</th><th className="p-2">Action</th></tr></thead>
                                <tbody>
                                    {users.map(u => (
                                        <tr key={u.username} className="border-b">
                                            <td className="p-2">{u.username}</td>
                                            <td className="p-2">
                                                <select value={u.role} onChange={e => handleRoleChange(u.username, e.target.value)} className="p-1 border rounded-md">
                                                    <option value="Super Admin">Super Admin</option>
                                                    <option value="Admin">Admin</option>
                                                    <option value="User">User</option>
                                                </select>
                                            </td>
                                            <td className="p-2">
                                                <button className="px-2 py-1 bg-red-600 text-white rounded-md hover:bg-red-700" onClick={() => handleDeleteUser(u.username)}><i className="fas fa-trash-alt"/></button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            <button className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" onClick={() => setShowAddUser(true)}>Add User</button>
                            <button className="px-4 py-2 bg-gray-300 rounded-md ml-2" onClick={() => setShowUserMgmt(false)}>Close</button>
                        </div>
                    </div>
                )}

                {/* add user modal */}
                {showAddUser && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white p-6 rounded-lg w-full max-w-md">
                            <h2 className="text-xl font-bold mb-4">Add New User</h2>
                            <div className="space-y-4">
                                <input id="new-username" placeholder="Username" className="w-full p-2 border rounded-md"/>
                                <select id="new-role" className="w-full p-2 border rounded-md">
                                    <option value="User">User</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Super Admin">Super Admin</option>
                                </select>
                                <div className="flex justify-end space-x-2">
                                    <button className="px-4 py-2 bg-gray-300 rounded-md" onClick={() => setShowAddUser(false)}>Cancel</button>
                                    <button className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                                            onClick={() => handleAddUser(document.getElementById('new-username').value, document.getElementById('new-role').value)}>Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                )}

                {/* change password modal */}
                {showChangePwd && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white p-6 rounded-lg w-full max-w-md">
                            <h2 className="text-xl font-bold mb-4">Change Password</h2>
                            <div className="space-y-4">
                                <input id="old-password" type="password" placeholder="Old password" className="w-full p-2 border rounded-md"/>
                                <input id="new-password" type="password" placeholder="New password" className="w-full p-2 border rounded-md"/>
                                <input id="confirm-password" type="password" placeholder="Confirm new" className="w-full p-2 border rounded-md"/>
                                <p className="text-xs text-gray-500">≥8 characters</p>
                                <div className="flex justify-end space-x-2">
                                    <button className="px-4 py-2 bg-gray-300 rounded-md" onClick={() => setShowChangePwd(false)}>Cancel</button>
                                    <button className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
                                            onClick={() => handleChangePassword(document.getElementById('old-password').value, document.getElementById('new-password').value, document.getElementById('confirm-password').value)}>Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                )}

                {/* main content */}
                <div className="container mx-auto p-6">
                    <div className="flex items-center justify-between mb-4">
                        <h2 className="text-2xl font-bold">
                            {new Date(currentYear, currentMonth-1).toLocaleString('en-US', {month: 'long', year: 'numeric'})} Manufacturing Plan (Daily)
                        </h2>
                        <div className="flex space-x-2">
                            <select value={currentMonth} onChange={e => handleMonthChange(parseInt(e.target.value), currentYear)} className="p-2 border rounded-md">
                                {monthOptions.map(o => <option key={o.value} value={o.value}>{o.label}</option>)}
                            </select>
                            <select value={currentYear} onChange={e => handleMonthChange(currentMonth, parseInt(e.target.value))} className="p-2 border rounded-md">
                                {yearOptions.map(y => <option key={y} value={y}>{y}</option>)}
                            </select>
                        </div>
                    </div>

                    {(user.role === 'Super Admin' || user.role === 'Admin') && (
                        <div className="mb-4 flex space-x-2">
                            <input id="new-equipment" placeholder="Equipment name" className="p-2 border rounded-md flex-grow"/>
                            <button className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" onClick={() => handleAddEquipment(document.getElementById('new-equipment').value)}>Add</button>
                        </div>
                    )}

                    <div className="mb-4 flex space-x-2 no-print">
                        <button className="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700" onClick={handleExportCSV}>Export CSV</button>
                        <button className="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700" onClick={handleExportPDF}>Export PDF</button>
                        <button className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" onClick={handlePrint}>Print</button>
                    </div>

                    <div className="overflow-x-auto">
                        <table className="w-full bg-white rounded-lg shadow-md">
                            <thead>
                                <tr className="bg-blue-600 text-white">
                                    <th className="p-2 text-left sticky-col bg-blue-600">Process / Equipment</th>
                                    {Object.keys(data[0] || {}).filter(k => k !== 'process' && k !== 'total').map(date => (
                                        <th key={date} className="p-2 w-20">{formatDate(parseInt(date))}</th>
                                    ))}
                                    <th className="p-2 w-20">Total</th>
                                    <th className="p-2 w-12 no-print">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {data.map((row, rowIndex) => (
                                    <tr key={row.process} className="border-b">
                                        <td className="p-2 sticky-col bg-white">
                                            {user.role === 'Super Admin' && editingProcess === rowIndex ? (
                                                <div className="flex items-center space-x-2">
                                                    <input value={editProcessValue} onChange={e => setEditProcessValue(e.target.value)} className="p-1 border rounded-md flex-grow"/>
                                                    <button className="px-2 py-1 bg-green-600 text-white rounded-md hover:bg-green-700" onClick={() => handleSaveProcess(rowIndex)}><i className="fas fa-check"/></button>
                                                    <button className="px-2 py-1 bg-gray-300 rounded-md" onClick={() => setEditingProcess(null)}><i className="fas fa-times"/></button>
                                                </div>
                                            ) : (
                                                <div className="flex items-center justify-between">
                                                    <span onDoubleClick={user.role === 'Super Admin' ? () => handleProcessDblClick(rowIndex) : null} className="cursor-pointer">{row.process}</span>
                                                    {user.role === 'Super Admin' && (
                                                        <div className="flex space-x-1 ml-2">
                                                            <button className="px-2 py-1 bg-gray-200 rounded-md disabled:opacity-50" disabled={rowIndex === 0} onClick={() => handleMoveUp(rowIndex)}><i className="fas fa-arrow-up"/></button>
                                                            <button className="px-2 py-1 bg-gray-200 rounded-md disabled:opacity-50" disabled={rowIndex === data.length-1} onClick={() => handleMoveDown(rowIndex)}><i className="fas fa-arrow-down"/></button>
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </td>
                                        {Object.keys(row).filter(k => k !== 'process' && k !== 'total').map(col => (
                                            <td key={col} className="p-2">
                                                {(user.role === 'Super Admin' || user.role === 'Admin') ? (
                                                    <input value={row[col]} onChange={e => handleDataEdit(rowIndex, col, e.target.value)} className="w-full p-1 border rounded-md"/>
                                                ) : row[col]}
                                            </td>
                                        ))}
                                        <td className="p-2">{row.total}</td>
                                        <td className="p-2 no-print">
                                            {user.role === 'Super Admin' && (
                                                <button onClick={() => setShowDelWarn(rowIndex)} className="text-red-600 hover:text-red-800">
                                                    <i className="fas fa-trash-alt"/>
                                                </button>
                                            )}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* delete warning */}
                    {showDelWarn !== null && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white p-6 rounded-lg w-full max-w-sm">
                                <h3 className="text-lg font-bold mb-2">Confirm Deletion</h3>
                                <p>Delete process “{data[showDelWarn]?.process}”? This action cannot be undone.</p>
                                <div className="mt-4 flex justify-end space-x-2">
                                    <button className="px-4 py-2 bg-gray-300 rounded-md" onClick={() => setShowDelWarn(null)}>Cancel</button>
                                    <button className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700" onClick={() => handleDeleteEquipment(showDelWarn)}>Delete</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* chart */}
                    <div className="mt-8">
                        <h3 className="text-xl font-bold mb-4">Daily Plan Overview</h3>
                        <Recharts.ResponsiveContainer width="100%" height={400}>
                            <Recharts.BarChart data={data}>
                                <Recharts.CartesianGrid strokeDasharray="3 3"/>
                                <Recharts.XAxis dataKey="process"/>
                                <Recharts.YAxis/>
                                <Recharts.Tooltip/>
                                <Recharts.Legend/>
                                {Object.keys(data[0] || {}).filter(k => k !== 'process' && k !== 'total').map((date, i) => (
                                    <Recharts.Bar key={date} dataKey={date} name={formatDate(parseInt(date))} fill={`#${((i*123457)%16777215).toString(16).padStart(6,'0')}`}/>
                                ))}
                            </Recharts.BarChart>
                        </Recharts.ResponsiveContainer>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
</script>
</body>
</html>
